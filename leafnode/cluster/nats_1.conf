# ===========================================
# NATS Cluster Node 1 Configuration
# ===========================================

server_name: nats-1
listen: 0.0.0.0:4222

# ===========================================
# JetStream Configuration
# ===========================================
jetstream {
    store_dir: /data/jetstream
    max_memory_store: 268435456  # 256MB
    max_file_store: 1073741824   # 1GB
}

# ===========================================
# Cluster Configuration
# ===========================================
cluster {
    name: NATS_CLUSTER
    listen: 0.0.0.0:6222
    
    routes: [
        nats://nats-2:6222,
        nats://nats-3:6222
    ]
}

# ===========================================
# Leafnode Configuration
# ===========================================
leafnodes {
    # Listen for incoming leafnode connections
    listen: 0.0.0.0:7422
    
    # No authorization for this example
    # In production, add authentication here
}

# ===========================================
# Accounts (Important for JetStream + Leafnodes)
# ===========================================
accounts {
    # System account for JetStream and internal operations
    SYS: {
        users: [{user: sys, password: sys}]
    }
    
    # Application account
    APP: {
        users: [{user: app, password: app}]
        
        jetstream: enabled
        
        # Export JetStream API subjects to leafnodes
        exports: [
            # Export all JetStream API subjects
            {stream: "$JS.API.>"}
            
            # Export JetStream acknowledgments
            {stream: "$JS.ACK.>"}
            
            # Export application subjects
            {stream: "orders.>"}
            
            # Export system events if needed
            {stream: "$JS.EVENT.>"}
            
            # Export reply subjects (critical for request/reply)
            {stream: "_INBOX.>", accounts: ["*"]}
        ]
    }
}

# Set system account
system_account: SYS

# ===========================================
# Monitoring
# ===========================================
http_port: 8222

# ===========================================
# Logging
# ===========================================
debug: false
trace: false
logtime: true