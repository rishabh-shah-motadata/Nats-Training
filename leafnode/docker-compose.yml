networks:
  nats-network:
    driver: bridge
    name: nats-leafnet

services:
  # Core NATS Cluster - Node 1
  nats-1:
    image: nats:latest
    container_name: nats-1
    command: [
      "-c", "/etc/nats-config/nats-1.conf"
    ]
    volumes:
      - ./cluster/nats_1.conf:/etc/nats-config/nats-1.conf
      - nats-1-data:/data/jetstream
    ports:
      - "4222:4222"   # Client port
      - "8222:8222"   # Monitoring
    networks:
      - nats-network
    restart: unless-stopped

  # Core NATS Cluster - Node 2
  nats-2:
    image: nats:latest
    container_name: nats-2
    command: [
      "-c", "/etc/nats-config/nats-2.conf"
    ]
    volumes:
      - ./cluster/nats_2.conf:/etc/nats-config/nats-2.conf
      - nats-2-data:/data/jetstream
    ports:
      - "4223:4223"
      - "8223:8223"
    networks:
      - nats-network
    restart: unless-stopped
    depends_on:
      - nats-1

  # Core NATS Cluster - Node 3
  nats-3:
    image: nats:latest
    container_name: nats-3
    command: [
      "-c", "/etc/nats-config/nats-3.conf"
    ]
    volumes:
      - ./cluster/nats_3.conf:/etc/nats-config/nats-3.conf
      - nats-3-data:/data/jetstream
    ports:
      - "4224:4224"
      - "8224:8224"
    networks:
      - nats-network
    restart: unless-stopped
    depends_on:
      - nats-1

  # Leafnode Server
  leafnode:
    image: nats:latest
    container_name: leafnode
    command: [
      "-c", "/etc/nats-config/leaf.conf"
    ]
    volumes:
      - ./leafnode/leaf.conf:/etc/nats-config/leaf.conf
      - leafnode-data:/data/jetstream
    ports:
      - "4221:4221"   # Client port for leafnode
      - "8221:8221"   # Leafnode monitoring
    networks:
      - nats-network
    restart: unless-stopped
    depends_on:
      - nats-1
      - nats-2
      - nats-3

volumes:
  nats-1-data:
  nats-2-data:
  nats-3-data:
  leafnode-data: