server_name: "leaf-1"
port: 4221
http_port: 8221

# CRITICAL: Enable JetStream on leaf node with DIFFERENT domain
jetstream {
    enabled: true
    store_dir: /data/jetstream
    max_memory_store: 1GB
    max_file_store: 10GB
    domain: leaf
}

# Same account structure as hub
accounts {
    APP: {
        jetstream: enabled
        users: [{user: "app", password: "app"}]
    }
    
    # System account
    SYS: {
        users: [{user: "sys", password: "syspass"}]
    }
}

# Set SYS as the system account
system_account: SYS

# Leafnode connections to ALL cluster nodes
leafnodes {
    remotes = [
        {
            url: "nats://sys:syspass@nats-1:7422"  # ✅ Added sys:syspass
            account: "SYS"
        },
        {
            url: "nats://app:app@nats-1:7422"      # ✅ Added app:app
            account: "APP"
        },
        {
            url: "nats://sys:syspass@nats-2:7423"  # ✅ Added sys:syspass
            account: "SYS"
        },
        {
            url: "nats://app:app@nats-2:7423"      # ✅ Added app:app
            account: "APP"
        },
        {
            url: "nats://sys:syspass@nats-3:7424"  # ✅ Added sys:syspass
            account: "SYS"
        },
        {
            url: "nats://app:app@nats-3:7424"      # ✅ Added app:app
            account: "APP"
        }
        # {
        #     url: "nats://nats-1:7422"
        # },
        # {
        #     url: "nats://nats-2:7423"
        # },
        # {
        #     url: "nats://nats-3:7424"
        # }
    ]
}

# Debug logging
debug: true
trace: true
logtime: true